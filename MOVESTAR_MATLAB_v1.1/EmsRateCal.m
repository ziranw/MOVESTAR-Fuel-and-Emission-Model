%=========================================================================%
%  EmsRateCal.m                                      Module of MOVESTAR   %
%                                                                         %
%  Script for calculating the emission rate based on MOVES (gram/hr).     %
%																		  %
%  Version of 08-10-2020             Copyright by Guoyuan Wu & Ziran Wang %
%  University of California, Riverside, USA								  %
%  gywu@cert.ucr.edu, ryanwang11@hotmail.com							  %
%=========================================================================%

function [Ems_rate] = EmsRateCal(Bin_data, veh_type)

if veh_type == 1            % Light duty vehicle or passenger car
% Preset the emission rate matrix for car (LDV)
Ems_Rate = [0	1.97892	0.0953798	0.0695436	0.00522486	0.0239643	48371.4	3441.528367
1	0.341669	0.0231352	0.0294708	0.00450976	0.0206844	44749.1	3183.808967
11	6.80345	0.0650524	0.103114	0.00447462	0.0205233	70367	5006.471316
12	11.1072	0.0498479	0.157418	0.00470869	0.0215969	97164	6913.024272
13	10.2406	0.0942146	0.368511	0.0066702	0.0305935	135036	9607.541328
14	14.6935	0.128156	0.650607	0.00661505	0.0303405	170626	12139.69865
15	21.3068	0.178659	1.15309	0.00636392	0.0291887	203467	14476.27012
16	35.9513	0.285382	2.40478	0.0165839	0.0760634	245748	17484.4787
21	8.86745	0.0973768	0.203915	0.00854285	0.0391826	95730.3	6811.019384
22	11.7489	0.0894292	0.331209	0.0113997	0.0522858	108968	7752.855264
23	15.1095	0.0964139	0.500717	0.00823071	0.0377509	132716	9442.477968
24	22.0873	0.183979	0.843921	0.00906222	0.0415647	170266	12114.08537
25	25.0671	0.18329	1.18354	0.0112721	0.0517003	227221	16166.31971
27	37.6451	0.289654	1.86362	0.0180833	0.0829407	299543	21311.88536
28	127.616	1.95524	6.85885	0.0395121	0.181226	403761	28726.78763
29	270.27	3.47139	12.0423	0.189873	0.870871	553155	39355.87194
30	949.244	5.73108	15.8433	0.281271	1.29007	694644	49422.53131
33	6.65783	0.0935418	0.434612	0.0117726	0.053996	136387	9703.662276
35	11.3684	0.129899	1.19894	0.0174424	0.0800013	218699	15559.99645
37	16.7341	0.166455	1.67539	0.0133771	0.0613553	284892	20269.49602
38	116.968	1.32031	5.8239	0.0327562	0.150239	371483	26430.27248
39	123.421	1.91714	8.66952	0.0689814	0.31639	494808	35204.59958
40	362.729	2.50657	10.9191	0.0796885	0.365499	630762	44877.45478]/3600;

elseif veh_type == 2        % Light duty truck
% Preset the emission rate matrix for truck (HDV)
Ems_Rate = [0	2.36609	0.0391707	0.0538503	0.00131955	0.0180855	73883.5	5256.663258
1	4.05557	0.000418121	0.0089791	0.00108472	0.014867	56979.3	4053.963236
11	6.52187	0.0228921	0.146868	0.00155411	0.0213005	92164.5	6557.319846
12	2.82379	0.0208503	0.155233	0.00156658	0.0214713	115308	8203.933584
13	9.76815	0.052262	0.363034	0.00211212	0.0289484	165833	11798.68628
14	14.2137	0.0725323	0.657844	0.00271017	0.0371452	210063	14945.56232
15	20.8813	0.103686	1.18797	0.00612354	0.0839285	253242	18017.66182
16	35.9857	0.171948	2.5348	0.017956	0.246103	316272	22502.12026
21	5.8165	0.0387213	0.254133	0.00212064	0.0290653	123291	8771.908068
22	9.33417	0.0462365	0.357951	0.00208597	0.02859	132348	9416.295504
23	13.1798	0.0650499	0.508789	0.00271128	0.0371605	163386	11624.58713
24	25.9039	0.115221	0.930889	0.00293965	0.0402905	211608	15055.48598
25	18.5265	0.124367	1.52098	0.00453134	0.062106	271723	19332.548
27	34.766	0.218173	2.14235	0.00870251	0.119276	374028	26611.34414
28	200.661	3.25428	8.21223	0.0536606	0.735465	499605	35545.89654
29	216.005	4.04662	11.1418	0.0769951	1.05529	684960	48733.53408
30	969.878	7.11962	12.8433	0.245917	3.37051	807005	57416.79174
33	10.9199	0.0703704	0.41958	0.00586679	0.0804096	178086	12670.46273
35	23.846	0.0921036	1.40529	0.00900861	0.123471	272535	19390.32018
37	28.9476	0.117916	2.28006	0.00918422	0.125878	360261	25631.84963
38	68.1954	1.15714	7.50412	0.0132642	0.181797	468102	33304.5211
39	167.612	2.11771	13.3438	0.0320607	0.43942	613382	43640.90254
40	407.603	2.7341	14.3353	0.0359667	0.492955	811659	57747.91453]/3600;

else
    disp('Please restrict the vehicle type into either 1 or 2');
end

% Calculate and output the Emission Rate for each pollutant
Ems_rate = (Bin_data'*Ems_Rate(:, 2:8));